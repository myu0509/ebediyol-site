<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ebedi Yol - Ziyaret Alanı</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; padding:0; height:100%; background:#222831; overflow:hidden; }
    #info {
      position:absolute; top:10px; left:10px; z-index:10;
      color:#fff; font-family:Arial, sans-serif; font-size:14px;
      background:rgba(0,0,0,0.5); padding:8px 12px; border-radius:8px;
    }
    #webgl-warning {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      color:#fff; font-family:Arial, sans-serif; background:#111; text-align:center; padding:20px;
    }
  </style>
</head>
<body>
  <div id="info">Tıkla → fare kilitlenir | WASD ile yürü | ESC: çıkış</div>
  <div id="webgl-warning" style="display:none;">Bu cihazda WebGL etkin değil gibi görünüyor. Lütfen farklı bir tarayıcı deneyin (Chrome/Edge) veya donanım hızlandırmasını açın.</div>

  <!-- ✅ KLASİK (modülsüz) CDN sürümü -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/PointerLockControls.js"></script>

  <script>
    // WebGL desteği kontrolü
    try {
      const testCanvas = document.createElement('canvas');
      const ok = !!(window.WebGLRenderingContext &&
                    (testCanvas.getContext('webgl') || testCanvas.getContext('experimental-webgl')));
      if (!ok) document.getElementById('webgl-warning').style.display = 'flex';
    } catch (e) {
      document.getElementById('webgl-warning').style.display = 'flex';
    }

    // --- SAHNE / KAMERA / RENDERER ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222831);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 2, 8);

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // --- IŞIKLAR ---
    const hemi = new THREE.HemisphereLight(0xffffff, 0x222233, 1.5);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 1.2);
    dir.position.set(5, 10, 7);
    dir.castShadow = true;
    scene.add(dir);

    // --- ZEMİN ---
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(120,120),
      new THREE.MeshStandardMaterial({ color:0x336633, roughness:1 })
    );
    ground.rotation.x = -Math.PI/2;
    ground.receiveShadow = true;
    scene.add(ground);

    // --- TEST KÜPÜ (ekranın çalıştığını anlamak için) ---
    const cube = new THREE.Mesh(
      new THREE.BoxGeometry(1,1,1),
      new THREE.MeshStandardMaterial({ color:0x00d1b2 })
    );
    cube.position.set(0, 1, -2);
    cube.castShadow = true;
    scene.add(cube);

    // --- MEZAR TAŞLARI: 5 sütun x 4 sıra = 20 adet ---
    const graveGeo = new THREE.BoxGeometry(0.6, 1, 0.2);
    const graveMat = new THREE.MeshStandardMaterial({ color:0xaaaaaa });
    const rows = 4, cols = 5, spacingX = 2, spacingZ = 2.5;
    const startX = -((cols-1)*spacingX)/2;
    const startZ = -((rows-1)*spacingZ)/2;

    for (let r=0; r<rows; r++){
      for (let c=0; c<cols; c++){
        const g = new THREE.Mesh(graveGeo, graveMat);
        g.position.set(startX + c*spacingX, 0.5, startZ + r*spacingZ);
        g.castShadow = true;
        scene.add(g);
      }
    }

    // --- KAMERA BAŞLANGIÇ BAKIŞI ---
    camera.lookAt(0, 0.5, 0); // merkezdeki taşlara bak

    // --- POINTER LOCK KONTROLLERİ ---
    const controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', () => controls.lock());

    const move = { f:false, b:false, l:false, r:false };
    const speed = 4.0;

    window.addEventListener('keydown', (e) => {
      if (e.code === 'KeyW') move.f = true;
      if (e.code === 'KeyS') move.b = true;
      if (e.code === 'KeyA') move.l = true;
      if (e.code === 'KeyD') move.r = true;
    });
    window.addEventListener('keyup', (e) => {
      if (e.code === 'KeyW') move.f = false;
      if (e.code === 'KeyS') move.b = false;
      if (e.code === 'KeyA') move.l = false;
      if (e.code === 'KeyD') move.r = false;
    });

    const clock = new THREE.Clock();

    function animate(){
      requestAnimationFrame(animate);
      const dt = Math.min(0.05, clock.getDelta());

      // test küpünü döndür (görsel referans)
      cube.rotation.y += 0.6 * dt;

      if (controls.isLocked) {
        const dirVec = new THREE.Vector3();
        camera.getWorldDirection(dirVec);
        dirVec.y = 0; dirVec.normalize();
        const right = new THREE.Vector3().crossVectors(dirVec, camera.up).normalize();

        const v = new THREE.Vector3();
        if (move.f) v.add(dirVec);
        if (move.b) v.sub(dirVec);
        if (move.l) v.add(right);
        if (move.r) v.sub(right);

        if (v.lengthSq() > 0) {
          v.normalize().multiplyScalar(speed * dt);
          camera.position.add(v);
        }
      }

      renderer.render(scene, camera);
    }
    animate();

    // --- BOYUTLAMA ---
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>

