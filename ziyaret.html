<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ebedi Yol - A Blok</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background: #1a1a1a; }
    #renderCanvas { width: 100%; height: 100%; touch-action: none; }
  </style>

  <style>
    #mobileControls {
      position: fixed;
      bottom: 30px;
      right: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 10;
    }

    .middleRow {
      display: flex;
      gap: 8px;
    }

    .ctrl {
      width: 55px;
      height: 55px;
      font-size: 24px;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.35);
      color: black;
      font-weight: bold;

      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      touch-action: none;
    }

    .ctrl:active {
      background: rgba(255,255,255,0.6);
    }
  </style>
</head>

<body>
  <canvas id="renderCanvas"></canvas>

  <div id="mobileControls">
    <button class="ctrl" id="btnUp">▲</button>
    <div class="middleRow">
      <button class="ctrl" id="btnLeft">◀</button>
      <button class="ctrl" id="btnRight">▶</button>
    </div>
    <button class="ctrl" id="btnDown">▼</button>
  </div>

  <!-- Babylon.js -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
  <script>
    /* =========================
       Temel SAHNE
    ==========================*/
    const scene = new BABYLON.Scene(engine);
    // Kuş sesi
const birdsSound = new BABYLON.Sound(
  "birds",
  "https://raw.githubusercontent.com/myu0509/ebediyol-site/main/sounds/birds.mp3",
  scene,
  null,
  { loop: true, autoplay: true, volume: 0.35 }
);

// Adım sesi
const stepSound = new BABYLON.Sound(
  "steps",
  "https://raw.githubusercontent.com/myu0509/ebediyol-site/main/sounds/steps.mp3",
  scene,
  null,
  { loop: false, autoplay: false, volume: 0.7 }
);

    scene.clearColor = new BABYLON.Color3(0.1, 0.15, 0.1);

    // Kamera
    const camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(0, 2, -10), scene);
    camera.attachControl(canvas, true);
    camera.speed = 0.5;


    /* =========================
       Sesler
    ==========================*/

    // Arka plan kuş sesi
    const birdsSound = new BABYLON.Sound(
      "birds",
      "https://raw.githubusercontent.com/myu0509/ebediyol-site/main/sounds/birds.mp3",
      scene,
      null,
      { loop: true, autoplay: true, volume: 0.35 }
    );

    // Adım sesi
    const stepSound = new BABYLON.Sound(
      "steps",
      "https://raw.githubusercontent.com/myu0509/ebediyol-site/main/sounds/steps.mp3",
      scene,
      null,
      { loop: false, autoplay: false, volume: 0.7 }
    );


    /* =========================
       Avatar
    ==========================*/
    let avatar = null;
    let moveForward = false;
    let moveBackward = false;
    let moveLeft = false;
    let moveRight = false;

    BABYLON.SceneLoader.ImportMeshAsync(
      "",
      "https://www.babylonjs.com/Scenes/Dude/",
      "Dude.babylon",
      scene
    ).then((res) => {
      avatar = res.meshes[0];
      avatar.scaling = new BABYLON.Vector3(0.012, 0.012, 0.012);
      avatar.position = new BABYLON.Vector3(0, 0, -5);
    });


    /* =========================
       Klavye Kontrol
    ==========================*/
    window.addEventListener("keydown", (e) => {
      if (e.key === "w" || e.key === "ArrowUp")    moveForward  = true;
      if (e.key === "s" || e.key === "ArrowDown")  moveBackward = true;
      if (e.key === "a" || e.key === "ArrowLeft")  moveLeft     = true;
      if (e.key === "d" || e.key === "ArrowRight") moveRight    = true;
    });

    window.addEventListener("keyup", (e) => {
      if (e.key === "w" || e.key === "ArrowUp")    moveForward  = false;
      if (e.key === "s" || e.key === "ArrowDown")  moveBackward = false;
      if (e.key === "a" || e.key === "ArrowLeft")  moveLeft     = false;
      if (e.key === "d" || e.key === "ArrowRight") moveRight    = false;
    });


    /* =========================
       Mobil Butonlar
    ==========================*/
    const btnUp    = document.getElementById("btnUp");
    const btnDown  = document.getElementById("btnDown");
    const btnLeft  = document.getElementById("btnLeft");
    const btnRight = document.getElementById("btnRight");

    if (btnUp) {
      btnUp.addEventListener("touchstart", () => moveForward = true);
      btnUp.addEventListener("touchend", () => moveForward = false);
    }
    if (btnDown) {
      btnDown.addEventListener("touchstart", () => moveBackward = true);
      btnDown.addEventListener("touchend", () => moveBackward = false);
    }
    if (btnLeft) {
      btnLeft.addEventListener("touchstart", () => moveLeft = true);
      btnLeft.addEventListener("touchend", () => moveLeft = false);
    }
    if (btnRight) {
      btnRight.addEventListener("touchstart", () => moveRight = true);
      btnRight.addEventListener("touchend", () => moveRight = false);
    }


    /* =========================
       Işık
    ==========================*/
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0,1,0), scene);
    light.intensity = 1.2;


    /* =========================
       Zemin
    ==========================*/
    const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 50, height: 50 }, scene);
    const groundMat = new BABYLON.StandardMaterial("groundMat", scene);
    groundMat.diffuseColor = new BABYLON.Color3(0.2,0.35,0.2);
    ground.material = groundMat;


    /* =========================
       Skybox
    ==========================*/
    (function addSkybox() {
      const sky = BABYLON.MeshBuilder.CreateBox("sky", { size: 200 }, scene);
      const skyMat = new BABYLON.StandardMaterial("skyMat", scene);
      skyMat.backFaceCulling = false;
      skyMat.disableLighting = true;
      skyMat.reflectionTexture = new BABYLON.CubeTexture(
        "https://playground.babylonjs.com/textures/skybox",
        scene
      );
      skyMat.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
      sky.material = skyMat;
    })();


    /* =========================
       Rastgele Mezar Veri Üretici
    ==========================*/
    function randomName() {
      const first = ["Ahmet","Mehmet","Ayşe","Fatma","Mustafa","Zeynep","Ali","Emine","Hatice","Cem","Hasan","Murat"];
      const last  = ["Yılmaz","Demir","Çelik","Arslan","Koç","Yavuz","Kaya","Polat","Acar","Uçar","Kurt"];
      return first[Math.floor(Math.random()*first.length)] + " " + last[Math.floor(Math.random()*last.length)];
    }

    function randomYear(start,end){ return Math.floor(Math.random()*(end-start))+start; }

    const gravesData = [];
    for(let i=0;i<100;i++){
      const b = randomYear(1930,1970);
      gravesData.push({
        name: randomName(),
        birth:b,
        death:b + randomYear(30,70)
      });
    }


    /* =========================
       Mezar Grid
    ==========================*/
    const rows = 10, cols = 10;
    const spacingX = 5, spacingZ = 5;
    const startX = -((cols - 1) * spacingX) / 2;
    const startZ = ((rows - 1) * spacingZ) / 2;

    const graveMat = new BABYLON.StandardMaterial("gMat",scene);
    graveMat.diffuseColor = new BABYLON.Color3(0.7,0.7,0.7);

    for (let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){

        // Mezar taşı
        const grave = BABYLON.MeshBuilder.CreateBox(`grave_${r}_${c}`,{
          width:0.8, height:1.2, depth:0.2
        },scene);
        grave.position.x = startX + c*spacingX;
        grave.position.y = 0.6;
        grave.position.z = startZ - r*spacingZ;
        grave.material = graveMat;

        // Toprak
        const mound = BABYLON.MeshBuilder.CreateCylinder(`mound_${r}_${c}`,{
          diameterTop:1.0, diameterBottom:1.8, height:0.2
        },scene);
        mound.scaling.z = 2;
        mound.position.set(grave.position.x,0.1,grave.position.z+0.5);

        const mm = new BABYLON.StandardMaterial("mm",scene);
        mm.diffuseColor = new BABYLON.Color3(0.3,0.2,0.1);
        mound.material = mm;

        // Yazı
        const idx = r*cols + c;
        const info = gravesData[idx];
        const labelPlane = BABYLON.MeshBuilder.CreatePlane(`label${idx}`,{width:1,height:0.5},scene);
        labelPlane.position = new BABYLON.Vector3(grave.position.x,grave.position.y+0.45,grave.position.z+0.15);
        labelPlane.rotation = new BABYLON.Vector3(0,Math.PI,0);

        const ui = BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(labelPlane);
        const txt = new BABYLON.GUI.TextBlock();
        txt.text = info.name + "\n" + info.birth + " - " + info.death;
        txt.color = "white";
        txt.fontSize = 40;
        ui.addControl(txt);
      }
    }


    /* =========================
       Çam Ağaçları
    ==========================*/
    (function(){
      function tree(x,z){
        const t = BABYLON.MeshBuilder.CreateCylinder("t",{diameterTop:0.4,diameterBottom:0.6,height:2},scene);
        t.position.set(x,1,z);
        const leaves = BABYLON.MeshBuilder.CreateCylinder("l",{diameterTop:0.1,diameterBottom:2.5,height:3},scene);
        leaves.position.set(x,3,z);
      }
      const size=25, step=5;
      for(let i=-size;i<=size;i+=step){
        tree(i,-size);
        tree(i, size);
        tree(-size,i);
        tree( size,i);
      }
    })();


    /* =========================
       Yol
    ==========================*/
    const mainRoad = BABYLON.MeshBuilder.CreateGround("road",{width:3,height:25},scene);
    mainRoad.position.set(0,0.02,-22);


    /* =========================
       Çit (3 taraf)
    ==========================*/
    function createFence(x1,z1,x2,z2){
      const dx=x2-x1, dz=z2-z1;
      const dist=Math.sqrt(dx*dx + dz*dz);
      const fence = BABYLON.MeshBuilder.CreateBox("f",{width:dist,height:1.2,depth:0.15},scene);
      fence.position.set((x1+x2)/2,0.6,(z1+z2)/2);
      fence.rotation.y = Math.atan2(dz,dx);
    }

    createFence(-25,-25, 25,-25);   // Alt
    createFence(-25, 25, 25, 25);   // Üst
    createFence( 25,-25, 25, 25);   // Sağ
    // Sol taraf açık !!

    
    /* =========================
       Kamera + Avatar + Sınırlar
    ==========================*/
    scene.onBeforeRenderObservable.add(()=>{

      if(avatar){
        camera.position.x = avatar.position.x - 4*Math.sin(camera.rotation.y);
        camera.position.z = avatar.position.z - 4*Math.cos(camera.rotation.y);
        camera.position.y = avatar.position.y + 1.8;
      }

      let speed = 0.15;

      if(moveForward && avatar){
        avatar.position.z += speed*Math.cos(camera.rotation.y);
        avatar.position.x += speed*Math.sin(camera.rotation.y);
        stepSound.play();
      }
      if(moveBackward && avatar){
        avatar.position.z -= speed*Math.cos(camera.rotation.y);
        avatar.position.x -= speed*Math.sin(camera.rotation.y);
        stepSound.play();
      }
      if(moveLeft && avatar){
        camera.rotation.y -= 0.04;
      }
      if(moveRight && avatar){
        camera.rotation.y += 0.04;
      }

      if(avatar){
        avatar.rotation.y = camera.rotation.y;
      }

      // Sınır
      const lim = 25;
      ["x","z"].forEach(axis=>{
        if(avatar.position[axis] >  lim) avatar.position[axis] =  lim;
        if(avatar.position[axis] < -lim) avatar.position[axis] = -lim;
      });

      if(camera.position.y < 1.6) camera.position.y = 1.6;
      if(camera.position.y > 3.0) camera.position.y = 3.0;
    });


    // Render
    engine.runRenderLoop(()=>scene.render());
    window.addEventListener("resize",()=>engine.resize());
  </script>
</body>
</html>

