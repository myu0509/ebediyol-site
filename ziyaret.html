<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ebedi Yol - A Blok</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background: #1a1a1a; }
    #renderCanvas { width: 100%; height: 100%; touch-action: none; }
  </style>
<style>
#mobileControls {
  position: fixed;
  bottom: 30px;
  right: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  z-index: 10;
}

.middleRow {
  display: flex;
  gap: 8px;
}

.ctrl {
  width: 55px;
  height: 55px;
  font-size: 24px;
  border-radius: 10px;
  border: none;
  background: rgba(255,255,255,0.35);
  color: black;
  font-weight: bold;

  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  touch-action: none;
}

.ctrl:active {
  background: rgba(255,255,255,0.6);
}
</style>

</head>
<body>
  <canvas id="renderCanvas"></canvas>
<div id="mobileControls">
  <button class="ctrl" id="btnUp">▲</button>
  <div class="middleRow">
    <button class="ctrl" id="btnLeft">◀</button>
    <button class="ctrl" id="btnRight">▶</button>
  </div>
  <button class="ctrl" id="btnDown">▼</button>
</div>

  <!-- Babylon.js çekirdek -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <!-- Babylon GUI (yazı etiketleri için GEREKLİ) -->
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
<script>
  // === Temel kurulum ===
  const canvas = document.getElementById("renderCanvas");
  const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });

  const scene = new BABYLON.Scene(engine);
  scene.clearColor = new BABYLON.Color3(0.1, 0.15, 0.1);

  // Kamera
  const camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(0, 2, -10), scene);
  camera.attachControl(canvas, true);
  camera.speed = 0.5;

  // Avatar değişkeni
  let avatar = null;

  // ✅ Sade silüet avatar
  avatar = BABYLON.MeshBuilder.CreateCapsule("avatar", {
    height: 2.6,
    radius: 0.45
  }, scene);

  avatar.position = new BABYLON.Vector3(0, 1.3, -5);

  var avMat = new BABYLON.StandardMaterial("avMat", scene);
  avMat.diffuseColor = new BABYLON.Color3(0.05, 0.05, 0.05);
  avatar.material = avMat;


  // Kontroller
  let moveForward = false;
  let moveBackward = false;
  let moveLeft = false;
  let moveRight = false;

  // Klavye kontrolü
  window.addEventListener("keydown", (e) => {
    if (e.key === "w" || e.key === "ArrowUp") moveForward = true;
    if (e.key === "s" || e.key === "ArrowDown") moveBackward = true;
    if (e.key === "a" || e.key === "ArrowLeft") moveLeft = true;
    if (e.key === "d" || e.key === "ArrowRight") moveRight = true;
  });

  window.addEventListener("keyup", (e) => {
    if (e.key === "w" || e.key === "ArrowUp") moveForward = false;
    if (e.key === "s" || e.key === "ArrowDown") moveBackward = false;
    if (e.key === "a" || e.key === "ArrowLeft") moveLeft = false;
    if (e.key === "d" || e.key === "ArrowRight") moveRight = false;
  });


  // Mobil butonlar
  const btnUp = document.getElementById("btnUp");
  const btnDown = document.getElementById("btnDown");
  const btnLeft = document.getElementById("btnLeft");
  const btnRight = document.getElementById("btnRight");

  if (btnUp) {
    btnUp.addEventListener("touchstart", () => moveForward = true);
    btnUp.addEventListener("touchend", () => moveForward = false);
  }

  if (btnDown) {
    btnDown.addEventListener("touchstart", () => moveBackward = true);
    btnDown.addEventListener("touchend", () => moveBackward = false);
  }

  if (btnLeft) {
    btnLeft.addEventListener("touchstart", () => moveLeft = true);
    btnLeft.addEventListener("touchend", () => moveLeft = false);
  }

  if (btnRight) {
    btnRight.addEventListener("touchstart", () => moveRight = true);
    btnRight.addEventListener("touchend", () => moveRight = false);
  }


  // Işık
  const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
  light.intensity = 1.2;


  // Zemin
  const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 50, height: 50 }, scene);
  const groundMat = new BABYLON.StandardMaterial("groundMat", scene);
  groundMat.diffuseColor = new BABYLON.Color3(0.2, 0.35, 0.2);
  ground.material = groundMat;


  // Skybox
  (function addSkybox() {
    const skybox = BABYLON.MeshBuilder.CreateBox("skyBox", { size: 200 }, scene);
    const skyboxMaterial = new BABYLON.StandardMaterial("skyBoxMat", scene);
    skyboxMaterial.backFaceCulling = false;
    skyboxMaterial.disableLighting = true;
    skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("https://playground.babylonjs.com/textures/skybox", scene);
    skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
    skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
    skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
    skybox.material = skyboxMaterial;
  })();


  // — Buradan sonrası: Mezarların, yolların ve ağaçların olduğu bölüm — 
  // ⬆ Bu kısımlara hiç dokunmuyoruz, olduğu gibi bırak.

  // --- (Senin mevcut kodun aynen devam eder) ----


  // === KAMERA – AVATAR TAKİP + HAREKET ===
  scene.onBeforeRenderObservable.add(() => {

    // Kamera avatarı takip etsin
    if (avatar) {
      camera.position.x = avatar.position.x - 4 * Math.sin(camera.rotation.y);
      camera.position.z = avatar.position.z - 4 * Math.cos(camera.rotation.y);
      camera.position.y = avatar.position.y + 1.8;
    }

    // Hareket
    let moveSpeed = 0.11;

    if (moveForward && avatar) {
      avatar.position.z += moveSpeed * Math.cos(camera.rotation.y);
      avatar.position.x += moveSpeed * Math.sin(camera.rotation.y);
    }

    if (moveBackward && avatar) {
      avatar.position.z -= moveSpeed * Math.cos(camera.rotation.y);
      avatar.position.x -= moveSpeed * Math.sin(camera.rotation.y);
    }

    if (moveLeft) {
      camera.rotation.y -= 0.04;
    }

    if (moveRight) {
      camera.rotation.y += 0.04;
    }

    // Avatar yönü kameraya uysun
    if (avatar) {
      avatar.rotation.y = camera.rotation.y;
    }

    // Kamera sınırları
    if (camera.position.x > 25) camera.position.x = 25;
    if (camera.position.x < -25) camera.position.x = -25;
    if (camera.position.z > 25) camera.position.z = 25;
    if (camera.position.z < -25) camera.position.z = -25;

    if (camera.position.y < 1.6) camera.position.y = 1.6;
    if (camera.position.y > 3.0) camera.position.y = 3.0;
  });


  // Render döngüsü
  engine.runRenderLoop(() => scene.render());
  window.addEventListener("resize", () => engine.resize());
</script>
</body>
</html>
