<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ebedi Yol - A Blok</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background: #1a1a1a; }
    #renderCanvas { width: 100%; height: 100%; touch-action: none; }

    /* Mobil yön tuşları */
    .control-btn {
      position: fixed;
      width: 55px; height: 55px;
      background: #ffffff22;
      border-radius: 10px;
      color: white;
      font-size: 22px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      border: 1px solid #ffffff55;
      backdrop-filter: blur(5px);
    }
    #btnUp    { bottom: 140px; right: 60px; }
    #btnDown  { bottom: 60px;  right: 60px; }
    #btnLeft  { bottom: 100px; right: 110px; }
    #btnRight { bottom: 100px; right: 10px; }
  </style>
</head>

<body>
  <canvas id="renderCanvas"></canvas>

  <!-- Mobil Kontroller -->
  <div id="btnUp"    class="control-btn">↑</div>
  <div id="btnDown"  class="control-btn">↓</div>
  <div id="btnLeft"  class="control-btn">←</div>
  <div id="btnRight" class="control-btn">→</div>

  <!-- BABYLON -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>

<script>
/* =============================
      TEMEL KURULUM
============================= */
const canvas = document.getElementById("renderCanvas");
const engine = new BABYLON.Engine(canvas, true);

/* === SAHNE === */
const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.1, 0.15, 0.1);

/* === KAMERA === */
const camera = new BABYLON.UniversalCamera("cam", new BABYLON.Vector3(0, 2, -10), scene);
camera.attachControl(canvas, true);
camera.speed = 0.5;

/* === IŞIK === */
const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
light.intensity = 1.2;

/* =============================
      AVATAR
============================= */
let avatar = BABYLON.MeshBuilder.CreateCapsule("avatar", {
  height: 2.6,
  radius: 0.45
}, scene);

avatar.position = new BABYLON.Vector3(0, 1.3, -5);

const avMat = new BABYLON.StandardMaterial("avMat", scene);
avMat.diffuseColor = new BABYLON.Color3(0.05, 0.05, 0.05);
avatar.material = avMat;

/* =============================
      GÖKYÜZÜ
============================= */
(function addSkybox() {
  const skybox = BABYLON.MeshBuilder.CreateBox("skyBox", { size: 200 }, scene);
  const skyboxMaterial = new BABYLON.StandardMaterial("skyBoxMat", scene);
  skyboxMaterial.backFaceCulling = false;
  skyboxMaterial.disableLighting = true;
  skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture(
      "https://playground.babylonjs.com/textures/skybox", scene
  );
  skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
  skybox.material = skyboxMaterial;
})();

/* =============================
      ZEMİN
============================= */
const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 50, height: 50 }, scene);
const groundMat = new BABYLON.StandardMaterial("groundMat", scene);
groundMat.diffuseColor = new BABYLON.Color3(0.2, 0.35, 0.2);
ground.material = groundMat;

/* =============================
      MEZARLAR
============================= */
const rows = 10, cols = 10;
const spacingX = 5, spacingZ = 5;
const startX = -((cols - 1) * spacingX) / 2;
const startZ = ((rows - 1) * spacingZ) / 2;

const graveMat = new BABYLON.StandardMaterial("graveMat", scene);
graveMat.diffuseColor = new BABYLON.Color3(0.7, 0.7, 0.7);

function randomName() {
  const first = ["Ahmet","Mehmet","Ayşe","Fatma","Mustafa","Kemal","Hasan","Zeynep"];
  const last  = ["Yılmaz","Demir","Çelik","Arslan","Yavuz","Kaya","Koç","Acar"];
  return first[Math.floor(Math.random()*first.length)] + " " + last[Math.floor(Math.random()*last.length)];
}

for (let r = 0; r < rows; r++) {
  for (let c = 0; c < cols; c++) {

    const grave = BABYLON.MeshBuilder.CreateBox("grave", {
      width: 0.8, height: 1.2, depth: 0.2
    }, scene);

    grave.position.x = startX + c * spacingX;
    grave.position.y = 0.6;
    grave.position.z = startZ - r * spacingZ;
    grave.material = graveMat;

    // Mezar yazısı
    const label = BABYLON.MeshBuilder.CreatePlane("lbl", { width: 0.9, height: 0.45 }, scene);
    label.position = new BABYLON.Vector3(grave.position.x, 1.2, grave.position.z + 0.15);
    label.billboardMode = BABYLON.Mesh.BILLBOARDMODE_NONE;
    label.rotation = new BABYLON.Vector3(0, Math.PI, 0);

    const ui = BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(label, 512, 256, false);
    const box = new BABYLON.GUI.Rectangle();
    box.thickness = 0;
    box.background = "rgba(0,0,0,0.35)";
    ui.addControl(box);

    const txt = new BABYLON.GUI.TextBlock();
    txt.text = randomName();
    txt.color = "white";
    txt.fontSize = "40px";
    txt.outlineColor = "black";
    txt.outlineWidth = 6;
    box.addControl(txt);
  }
}

/* =============================
      AĞAÇLAR
============================= */
(function trees(){
  function tree(x,z){
    let t = BABYLON.MeshBuilder.CreateCylinder("t",{height:2,diameterTop:0.4,diameterBottom:0.6},scene);
    t.position.set(x,1,z);
    let m = new BABYLON.StandardMaterial("m",scene);
    m.diffuseColor = new BABYLON.Color3(0.3,0.15,0.05);
    t.material = m;
    let l = BABYLON.MeshBuilder.CreateCylinder("l",{height:3,diameterTop:0.1,diameterBottom:2.2},scene);
    l.position.set(x,3,z);
    let lm = new BABYLON.StandardMaterial("lm",scene);
    lm.diffuseColor = new BABYLON.Color3(0.05,0.25,0.1);
    l.material = lm;
  }
  for(let i=-25;i<=25;i+=5){
    tree(i,-25); tree(i,25); tree(-25,i); tree(25,i);
  }
})();

/* =============================
      YÖNETİM & HAREKET
============================= */
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;

window.addEventListener("keydown",(e)=>{
  if(e.key==="w"||e.key==="ArrowUp") moveForward=true;
  if(e.key==="s"||e.key==="ArrowDown") moveBackward=true;
  if(e.key==="a"||e.key==="ArrowLeft") moveLeft=true;
  if(e.key==="d"||e.key==="ArrowRight") moveRight=true;
});
window.addEventListener("keyup",(e)=>{
  if(e.key==="w"||e.key==="ArrowUp") moveForward=false;
  if(e.key==="s"||e.key==="ArrowDown") moveBackward=false;
  if(e.key==="a"||e.key==="ArrowLeft") moveLeft=false;
  if(e.key==="d"||e.key==="ArrowRight") moveRight=false;
});

/* === Mobil dokunma === */
["Up","Down","Left","Right"].forEach(key=>{
  let b=document.getElementById("btn"+key);
  if(!b) return;
  b.addEventListener("touchstart",()=>eval("move"+key+"=true"));
  b.addEventListener("touchend",()=>eval("move"+key+"=false"));
});

/* === Oyun Döngüsü === */
scene.onBeforeRenderObservable.add(()=>{

  let speed = 0.12;

  if(moveForward){
    avatar.position.z += speed * Math.cos(camera.rotation.y);
    avatar.position.x += speed * Math.sin(camera.rotation.y);
  }
  if(moveBackward){
    avatar.position.z -= speed * Math.cos(camera.rotation.y);
    avatar.position.x -= speed * Math.sin(camera.rotation.y);
  }
  if(moveLeft){
    camera.rotation.y -= 0.04;
  }
  if(moveRight){
    camera.rotation.y += 0.04;
  }

  avatar.rotation.y = camera.rotation.y;

  camera.position.x = avatar.position.x - 4 * Math.sin(camera.rotation.y);
  camera.position.z = avatar.position.z - 4 * Math.cos(camera.rotation.y);
  camera.position.y = avatar.position.y + 1.8;

});

engine.runRenderLoop(()=>scene.render());
window.addEventListener("resize",()=>engine.resize());
</script>

</body>
</html>
