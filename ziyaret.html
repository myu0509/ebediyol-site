<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ebedi Yol - A Blok</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background: #1a1a1a; }
    #renderCanvas { width: 100%; height: 100%; touch-action: none; }
  </style>
<style>
#mobileControls {
  position: fixed;
  bottom: 30px;
  right: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  z-index: 10;
}

.middleRow {
  display: flex;
  gap: 8px;
}

.ctrl {
  width: 55px;
  height: 55px;
  font-size: 24px;
  border-radius: 10px;
  border: none;
  background: rgba(255,255,255,0.35);
  color: black;
  font-weight: bold;

  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  touch-action: none;
}

.ctrl:active {
  background: rgba(255,255,255,0.6);
}
</style>

</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <audio id="birds" src="https://raw.githubusercontent.com/myu0509/ebediyol-site/main/sounds/birds.mp3?raw=1" preload="auto" loop></audio>
<audio id="steps" src="https://raw.githubusercontent.com/myu0509/ebediyol-site/main/sounds/steps.mp3?raw=1" preload="auto"></audio>
<div id="mobileControls">
  <button class="ctrl" id="btnUp">â–²</button>
  <div class="middleRow">
    <button class="ctrl" id="btnLeft">â—€</button>
    <button class="ctrl" id="btnRight">â–¶</button>
  </div>
  <button class="ctrl" id="btnDown">â–¼</button>
</div>

  <!-- Babylon.js Ã§ekirdek -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <!-- Babylon GUI (yazÄ± etiketleri iÃ§in GEREKLÄ°) -->
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>

  <script>
    // --- Temel kurulum ---
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });

    const scene = new BABYLON.Scene(engine);
    // âœ… Ses referanslarÄ±
const birds = document.getElementById("birds");
const steps = document.getElementById("steps");

// âœ… Ä°lk tÄ±klamada kuÅŸ sesini baÅŸlat
window.addEventListener("pointerdown", () => {
  try {
    birds.volume = 0.35;
    birds.play().catch(()=>{});
  } catch(e){}
}, { once:true });
    scene.clearColor = new BABYLON.Color3(0.1, 0.15, 0.1);

    // Kamera
    const camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(0, 2, -10), scene);
    camera.attachControl(canvas, true);
    camera.speed = 0.5;
// âœ… Mobil hareket deÄŸiÅŸkenleri
let moveForward = false;
let moveBackward = false;
let moveLeft = false;
let moveRight = false;
let avatar = null;

BABYLON.SceneLoader.ImportMeshAsync(
  "",
  "https://www.babylonjs.com/Scenes/Dude/",
  "Dude.babylon",
  scene
).then((res) => {
  avatar = res.meshes[0];
  avatar.scaling = new BABYLON.Vector3(0.012, 0.012, 0.012);
  avatar.position = new BABYLON.Vector3(0, 0, -5);
});
// âœ… Klavye kontrolÃ¼
window.addEventListener("keydown", (e) => {
  if (e.key === "w" || e.key === "ArrowUp")    moveForward  = true;
  if (e.key === "s" || e.key === "ArrowDown")  moveBackward = true;
  if (e.key === "a" || e.key === "ArrowLeft")  moveLeft     = true;
  if (e.key === "d" || e.key === "ArrowRight") moveRight    = true;
});

window.addEventListener("keyup", (e) => {
  if (e.key === "w" || e.key === "ArrowUp")    moveForward  = false;
  if (e.key === "s" || e.key === "ArrowDown")  moveBackward = false;
  if (e.key === "a" || e.key === "ArrowLeft")  moveLeft     = false;
  if (e.key === "d" || e.key === "ArrowRight") moveRight    = false;
});

// âœ… Butonlara dokunma olaylarÄ±
const btnUp = document.getElementById("btnUp");
const btnDown = document.getElementById("btnDown");
const btnLeft = document.getElementById("btnLeft");
const btnRight = document.getElementById("btnRight");

if (btnUp) {
  btnUp.addEventListener("touchstart", () => moveForward = true);
  btnUp.addEventListener("touchend", () => moveForward = false);
}

if (btnDown) {
  btnDown.addEventListener("touchstart", () => moveBackward = true);
  btnDown.addEventListener("touchend", () => moveBackward = false);
}

if (btnLeft) {
  btnLeft.addEventListener("touchstart", () => moveLeft = true);
  btnLeft.addEventListener("touchend", () => moveLeft = false);
}

if (btnRight) {
  btnRight.addEventListener("touchstart", () => moveRight = true);
  btnRight.addEventListener("touchend", () => moveRight = false);
}

    // IÅŸÄ±k
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
    light.intensity = 1.2;

    // Zemin (50x50)
    const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 50, height: 50 }, scene);
    const groundMat = new BABYLON.StandardMaterial("groundMat", scene);
    groundMat.diffuseColor = new BABYLON.Color3(0.2, 0.35, 0.2);
    ground.material = groundMat;

    // Skybox (gÃ¶kyÃ¼zÃ¼)
    (function addSkybox() {
      const skybox = BABYLON.MeshBuilder.CreateBox("skyBox", { size: 200 }, scene);
      const skyboxMaterial = new BABYLON.StandardMaterial("skyBoxMat", scene);
      skyboxMaterial.backFaceCulling = false;
      skyboxMaterial.disableLighting = true;
      skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("https://playground.babylonjs.com/textures/skybox", scene);
      skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
      skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
      skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
      skybox.material = skyboxMaterial;
    })();

    // Mezar isimleri (Ã¶rnek liste - 100 mezar iÃ§in dÃ¶ner; olmayanlara "Mezar" yazar)
    const gravesData = [
      "Ahmet YÄ±lmaz","Fatma Demir","Mehmet Aksoy","AyÅŸe Kaya","HÃ¼seyin Arslan","Zeynep Ã‡elik","Ali YÄ±ldÄ±rÄ±m","Emine Kurt","Hasan Ã‡etin","Meryem UÃ§ar",
      "Ä°smail Åžahin","Hatice GÃ¼neÅŸ","Mustafa KoÃ§","Elif Ã–z","Kemal YalÃ§Ä±n","Hacer Bozkurt","Ismail Kuzucu","Fadime KÄ±lÄ±Ã§","Bekir Acar","Rabia Polat"
      // Ä°stersen burayÄ± geniÅŸletebilirsin; liste bittiÄŸinde kalan mezarlara "Mezar" yazÄ±lÄ±r.
    ];

    // Mezarlar (10x10 = 100)
    const graveMat = new BABYLON.StandardMaterial("graveMat", scene);
    graveMat.diffuseColor = new BABYLON.Color3(0.7, 0.7, 0.7);
// âœ… Rastgele kiÅŸi Ã¼retici
function randomName() {
  const firstNames = ["Ahmet","Mehmet","AyÅŸe","Fatma","Mustafa","HÃ¼seyin","Zeynep","Ali","Emine","Hatice","Yunus","Cem","Hasan","Halil","Murat","Seda","GÃ¼l","Rabia","Esra","Kemal"];
  const lastNames  = ["YÄ±lmaz","Demir","Ã‡elik","Arslan","Toprak","Yavuz","Kaya","YÄ±ldÄ±rÄ±m","Ã‡etin","Polat","KoÃ§","Acar","UÃ§ar","Kurt","Kuzucu","Turan","Tekin","Ã–ztÃ¼rk","Kaplan","Kara"];
  const fn = firstNames[Math.floor(Math.random()*firstNames.length)];
  const ln = lastNames[Math.floor(Math.random()*lastNames.length)];
  return fn + " " + ln;
}

function randomBirthYear() {
  return Math.floor(Math.random() * 41) + 1930; // 1930â€“1970
}

function randomDeathYear(birth) {
  return birth + Math.floor(Math.random() * 41) + 30; // 30â€“70 yÄ±l sonra
}

// âœ… 100 kiÅŸilik mezar listesi Ã¼ret
for (let i = 0; i < 100; i++) {
  const birth = randomBirthYear();
  const death = randomDeathYear(birth);
  gravesData.push({
    name: randomName(),
    birth,
    death
  });
}

    const rows = 10, cols = 10;
    const spacingX = 5, spacingZ = 5;
    const startX = -((cols - 1) * spacingX) / 2;
    const startZ = ((rows - 1) * spacingZ) / 2;

    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {

        // Mezar taÅŸÄ±
        const grave = BABYLON.MeshBuilder.CreateBox(`grave_${r}_${c}`, {
          width: 0.8, height: 1.2, depth: 0.2
        }, scene);
        grave.position.x = startX + c * spacingX;
        grave.position.y = 0.6;
        grave.position.z = startZ - r * spacingZ;
        grave.material = graveMat;

        // Toprak hÃ¶yÃ¼ÄŸÃ¼
        const mound = BABYLON.MeshBuilder.CreateCylinder(`mound_${r}_${c}`, {
          diameterTop: 1.0,
          diameterBottom: 1.8,
          height: 0.2,
          tessellation: 16
        }, scene);
        mound.scaling.z = 2;
        mound.position.x = grave.position.x;
        mound.position.y = 0.1;
        mound.position.z = grave.position.z + 0.5;
        const moundMat = new BABYLON.StandardMaterial("moundMat", scene);
        moundMat.diffuseColor = new BABYLON.Color3(0.3, 0.2, 0.1);
        mound.material = moundMat;
// âœ… Mezar yazÄ±sÄ±
let idx = r * cols + c;
let person = gravesData[idx] ?? null;

let labelText = "Mezar";
if (person) {
  labelText = `${person.name}\n${person.birth} - ${person.death}`;
}

const labelPlane = BABYLON.MeshBuilder.CreatePlane(`label_${idx}`, { width: 0.9, height: 0.45 }, scene);
labelPlane.position = new BABYLON.Vector3(grave.position.x, grave.position.y + 0.45, grave.position.z + 0.16);
labelPlane.billboardMode = BABYLON.Mesh.BILLBOARDMODE_NONE;
labelPlane.rotationQuaternion = null;
labelPlane.rotation = new BABYLON.Vector3(0, Math.PI, 0);

// GUI
const ui = BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(labelPlane, 512, 256, false);
const bg = new BABYLON.GUI.Rectangle();
bg.thickness = 0;
bg.background = "rgba(0,0,0,0.35)";
ui.addControl(bg);

const text = new BABYLON.GUI.TextBlock();
text.text = labelText;
text.color = "white";
text.fontSize = "40px";
text.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
text.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;
text.outlineColor = "black";
text.outlineWidth = 6;
bg.addControl(text);
var candlePlane = BABYLON.MeshBuilder.CreatePlane(`candle_${idx}`, { width: 0.25, height: 0.25 }, scene);
candlePlane.position = new BABYLON.Vector3(grave.position.x, grave.position.y + 0.9, grave.position.z + 0.18);
candlePlane.billboardMode = BABYLON.Mesh.BILLBOARDMODE_Y;

var candleUI = BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(candlePlane);
var candleText = new BABYLON.GUI.TextBlock();
candleText.text = "ðŸ•¯\nSeÃ§enekler";
candleText.color = "yellow";
candleText.fontSize = "36px";
candleText.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
candleText.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;
candleUI.addControl(candleText);

// ðŸ”¥ TÄ±klama â†’ MenÃ¼ AÃ§
candlePlane.actionManager = new BABYLON.ActionManager(scene);
candlePlane.actionManager.registerAction(
    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, function () {
        openGraveMenu(person);
    })
);

      }
    }

    // Ã‡am aÄŸaÃ§larÄ± (Ã§evreye)
    (function addTrees() {
      function createTree(x, z) {
        const trunk = BABYLON.MeshBuilder.CreateCylinder("trunk", {
          diameterTop: 0.4, diameterBottom: 0.6, height: 2
        }, scene);
        trunk.position.set(x, 1, z);
        const trunkMat = new BABYLON.StandardMaterial("trunkMat", scene);
        trunkMat.diffuseColor = new BABYLON.Color3(0.3, 0.15, 0.05);
        trunk.material = trunkMat;

        const leaves = BABYLON.MeshBuilder.CreateCylinder("leaves", {
          diameterTop: 0.1, diameterBottom: 2.5, height: 3
        }, scene);
        leaves.position.set(x, 3, z);
        const leavesMat = new BABYLON.StandardMaterial("leavesMat", scene);
        leavesMat.diffuseColor = new BABYLON.Color3(0.05, 0.25, 0.1);
        leaves.material = leavesMat;
      }

      const size = 25; // sÄ±nÄ±r yarÄ±Ã§apÄ±
      const step = 5;
      for (let i = -size; i <= size; i += step) {
        createTree(i, -size);
        createTree(i,  size);
        createTree(-size, i);
        createTree( size, i);
      }
    })();
// === Ã‡Ä°TLER ===
(function addFences() {

  const fenceMat = new BABYLON.StandardMaterial("fenceMat", scene);
  fenceMat.diffuseColor = new BABYLON.Color3(0.6, 0.45, 0.25);

  // Tek bir Ã§it parÃ§asÄ±
  function makeFence(x, z, rotY = 0) {
    const pole = BABYLON.MeshBuilder.CreateBox("fPole", { width: 0.1, height: 1.2, depth: 0.1 }, scene);
    pole.position.set(x, 0.6, z);
    pole.material = fenceMat;

    const bar = BABYLON.MeshBuilder.CreateBox("fBar", { width: 1.5, height: 0.15, depth: 0.1 }, scene);
    bar.position.set(x, 0.9, z);
    bar.rotation.y = rotY;
    bar.material = fenceMat;
  }

  // --- SOL KENAR (X = -25, Z -25 â†’ +25)
  for (let z = -25; z <= 25; z += 2) {
    makeFence(-25, z, Math.PI / 2);
  }

  // --- SAÄž KENAR (X = +25, Z -25 â†’ +25)
  for (let z = -25; z <= 25; z += 2) {
    makeFence(25, z, Math.PI / 2);
  }

  // --- ÃœST KENAR (Z = +25, X -25 â†’ +25)
  for (let x = -25; x <= 25; x += 2) {
    makeFence(x, 25);
  }

})();

    // Yollar (siyah-beyaz/gri, dokusuz â€“ sade)
    (function addRoads() {
      // GiriÅŸ â†’ merkeze dÃ¼z yol
      const mainRoad = BABYLON.MeshBuilder.CreateGround("mainRoad", { width: 3, height: 25 }, scene);
      mainRoad.position.set(0, 0.02, -22); // giriÅŸe yakÄ±n baÅŸlasÄ±n
      const mainRoadMat = new BABYLON.StandardMaterial("mainRoadMat", scene);
      mainRoadMat.diffuseColor = new BABYLON.Color3(0.55, 0.55, 0.55);
      mainRoadMat.specularColor = new BABYLON.Color3(0, 0, 0);
      mainRoad.material = mainRoadMat;

      // MezarlarÄ±n ortasÄ±ndan yatay yol (ince)
      const rowRoad = BABYLON.MeshBuilder.CreateGround("rowRoad", { width: 50, height: 1.5 }, scene);
      rowRoad.position.set(0, 0.02, 0);
      const rowRoadMat = new BABYLON.StandardMaterial("rowRoadMat", scene);
      rowRoadMat.diffuseColor = new BABYLON.Color3(0.6, 0.6, 0.6);
      rowRoadMat.specularColor = new BABYLON.Color3(0, 0, 0);
      rowRoad.material = rowRoadMat;
    })();

    // Kamera sÄ±nÄ±rÄ± + yÃ¼kseklik sabitleme
    scene.onBeforeRenderObservable.add(() => {
      // Kamera avatarÄ± takip etsin
if (avatar) {
  camera.position.x = avatar.position.x - 4 * Math.sin(camera.rotation.y);
  camera.position.z = avatar.position.z - 4 * Math.cos(camera.rotation.y);
  camera.position.y = avatar.position.y + 1.8;
}
if (typeof window.__stepCd === "undefined") window.__stepCd = 0;
const dt = engine.getDeltaTime();
window.__stepCd = Math.max(0, window.__stepCd - dt);

// âœ… AdÄ±m sesi â€” sadece yÃ¼rÃ¼rken
if (avatar && steps) {
  const moving = (moveForward || moveBackward);
  
  if (moving) {
    if (steps.paused) {
      steps.currentTime = 0;
      steps.play().catch(()=>{});
    }
  } else {
    steps.pause();
  }
}

      // âœ… Mobil hareket uygula
let moveSpeed = 0.11;

if (moveForward && avatar) {
  avatar.position.z += moveSpeed * Math.cos(camera.rotation.y);
  avatar.position.x += moveSpeed * Math.sin(camera.rotation.y);
}

if (moveBackward && avatar) {
  avatar.position.z -= moveSpeed * Math.cos(camera.rotation.y);
  avatar.position.x -= moveSpeed * Math.sin(camera.rotation.y);
}

if (moveLeft) {
  camera.rotation.y -= 0.04;
}

if (moveRight) {
  camera.rotation.y += 0.04;
}
if (avatar) {
  avatar.rotation.y = camera.rotation.y;
}
// Avatar sÄ±nÄ±r kontrolÃ¼
if (avatar) {
  if (avatar.position.x > 25) avatar.position.x = 25;
  if (avatar.position.x < -25) avatar.position.x = -25;
  if (avatar.position.z > 25) avatar.position.z = 25;
  if (avatar.position.z < -25) avatar.position.z = -25;
}

      if (camera.position.x > 25) camera.position.x = 25;
      if (camera.position.x < -25) camera.position.x = -25;
      if (camera.position.z > 25) camera.position.z = 25;
      if (camera.position.z < -25) camera.position.z = -25;

      if (camera.position.y < 1.6) camera.position.y = 1.6;
      if (camera.position.y > 3.0) camera.position.y = 3.0;
    });

    // Render dÃ¶ngÃ¼sÃ¼
    /* ==== MEZAR MENÃœSÃœ: FONKSÄ°YONLAR ==== */
/* HTML tarafÄ±nda id'leri zaten ekledin:
   #graveMenu, #prayBtn, #flowerBtn, #noteBtn, #graveTitle
*/

const graveMenu   = document.getElementById("graveMenu");
const graveTitle  = document.getElementById("graveTitle");
const prayBtn     = document.getElementById("prayBtn");
const flowerBtn   = document.getElementById("flowerBtn");
const noteBtn     = document.getElementById("noteBtn");

let _currentGraveData = null;   // { name, birth, death } gelebilir
let _currentGraveMesh = null;   // ileride gerekirse (ÅŸimdilik null kalabilir)

// Mum â€œðŸ•¯ SeÃ§eneklerâ€ ikonunda Ã§aÄŸÄ±rdÄ±ÄŸÄ±n fonksiyon:
// candlePlane.registerAction(... openGraveMenu(person) ...)
window.openGraveMenu = function(person, graveMesh=null){
  _currentGraveData = person || null;
  _currentGraveMesh = graveMesh || null;

  if (person && person.name) {
    graveTitle.textContent = `${person.name} â€¢ ${person.birth} - ${person.death}`;
  } else {
    graveTitle.textContent = "Ziyaret";
  }

  graveMenu.style.display = "block";
};

window.closeMenu = function(){
  graveMenu.style.display = "none";
  _currentGraveData = null;
  _currentGraveMesh = null;
};

// â€” Basit ilk sÃ¼rÃ¼m davranÄ±ÅŸlarÄ± â€”
// (Åžimdilik alert; ileride gerÃ§ek Ã§iÃ§ek objesi / dua sesi / anÄ± kaydÄ± ekleyeceÄŸiz)
function _toast(msg){
  // Ä°stersen alert yerine non-blocking minik bildirim de yazabiliriz.
  alert(msg);
}

window.pray = function(){
  _toast("ðŸ•¯ Dua okundu.");
  closeMenu();
};

window.leaveFlower = function(){
  _toast("ðŸŒ· Ã‡iÃ§ek bÄ±rakÄ±ldÄ±.");
  closeMenu();
};

window.memory = function(){
  const note = prompt("AnÄ± defterine bir not yaz:");
  if (note && note.trim().length){
    // TODO: localStorage/server kaydÄ± yapÄ±labilir
    _toast("âœ… Not kaydedildi.");
  }
  closeMenu();
};

// MenÃ¼nÃ¼n kendi butonlarÄ±na tÄ±klama (eÄŸer HTML'de onclick yazmadÄ±ysan)
if (prayBtn)   prayBtn.addEventListener("click",  window.pray);
if (flowerBtn) flowerBtn.addEventListener("click",window.leaveFlower);
if (noteBtn)   noteBtn.addEventListener("click",  window.memory);

    engine.runRenderLoop(() => scene.render());
    window.addEventListener("resize", () => engine.resize());
  </script>
  <!-- ==== MEZAR MENÃœSÃœ ==== -->
<div id="graveMenu" style="
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(30,30,30,0.9);
  padding: 18px;
  border-radius: 12px;
  border: 2px solid #ccc;
  display: none;
  text-align: center;
  color: white;
  z-index: 200;
">
  <h3 id="graveTitle">Mezar</h3>
  <button class="menuBtn" onclick="pray()">Dua Et</button>
  <button class="menuBtn" onclick="leaveFlower()">Ã‡iÃ§ek BÄ±rak</button>
  <button class="menuBtn" onclick="memory()">AnÄ± Defteri</button>
  <br><br>
  <button class="menuBtn" onclick="closeMenu()">Kapat âœ–</button>
</div>

<style>
.menuBtn {
  display: block;
  margin: 6px auto;
  padding: 10px;
  width: 140px;
  background: #ffffff33;
  border: 1px solid #aaa;
  border-radius: 6px;
  color: white;
  font-size: 15px;
}
.menuBtn:hover {
  background: #ffffff55;
}
</style>

</body>
</html>
